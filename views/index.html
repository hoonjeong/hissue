<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="이슈 브리핑 서비스 HI! ISSUE! - AI가 최신 이슈를 자세하게 설명해드립니다">
    <meta name="keywords" content="이슈 브리핑, 최신 이슈, 트렌드, 뉴스, AI 분석, HI ISSUE">
    <meta property="og:title" content="HI! ISSUE! - 이슈 브리핑 서비스">
    <meta property="og:description" content="이슈 브리핑 서비스 - 구글 트렌드 기반 실시간 이슈를 AI가 쉽고 자세하게 설명해드립니다">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://hissue.kr">
    <meta property="og:site_name" content="HI! ISSUE!">
    <meta property="og:locale" content="ko_KR">
    
    <!-- Twitter Card Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="HI! ISSUE! - 이슈 브리핑 서비스">
    <meta name="twitter:description" content="AI가 최신 이슈를 자세하게 설명해드립니다">
    
    <!-- 추가 SEO 메타 태그 -->
    <meta name="author" content="HI! ISSUE!">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://hissue.kr">
    
    <!-- 네이버 사이트 소유권 확인 -->
    <meta name="naver-site-verification" content="437742dff60fb4a6a4b67f9c4d40edafa5c597db" />
    
    <title>HI! ISSUE! - 이슈 브리핑 서비스</title>
    <link rel="stylesheet" href="/css/style.css">
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5588520972347187"
     crossorigin="anonymous"></script>
</head>
<body>
    <header>
        <div class="header-container">
            <div class="logo-area">
                <nav class="nav-menu">
                    <a href="/" class="nav-item active">Hissue AI 이슈브리핑</a>
                    <a href="/coupang" class="nav-item">쿠팡 가전제품 할인 베스트</a>
                </nav>
            </div>
            <div class="search-area">
                <form action="/" method="get" class="search-form">
                    <div class="search-group">
                        <input type="text" id="search" name="search" value="<%= search %>" placeholder="궁금한 이슈를 검색해보세요">
                        <button type="submit">검색</button>
                    </div>
                </form>
            </div>
        </div>
    </header>

    <main>
        <div class="content-controls">
            <div class="sort-buttons">
                <a href="/?sort=recent<%= search ? '&search=' + search : '' %>" class="<%= sort === 'recent' ? 'active' : '' %>">최신순</a>
                <a href="/?sort=score<%= search ? '&search=' + search : '' %>" class="<%= sort === 'score' ? 'active' : '' %>">조회순</a>
                <span class="last-update">최종 업데이트: <%= lastUpdate %></span>
            </div>
        </div>

        <div class="content-list">
            <% contents.forEach(function(content) { %>
                <article class="content-item" onclick="location.href='/content/<%= content.id %>'">
                    <% if (content.news_item_picture_1) { %>
                        <img src="<%= content.news_item_picture_1 %>" alt="<%= content.subject %>" class="thumbnail">
                    <% } else { %>
                        <div class="no-image">이미지 없음</div>
                    <% } %>
                    <h2>
                        <% if (search) { %>
                            <%- content.subject.replace(new RegExp('(' + search + ')', 'gi'), '<strong>$1</strong>') %>
                        <% } else { %>
                            <%= content.subject %>
                        <% } %>
                        <span class="comment-count" data-content-id="<%= content.id %>" style="color: red;"></span>
                    </h2>
                    <div class="content-info">
                        <% 
                        const insertDate = new Date(content.insert_time);
                        const year = String(insertDate.getFullYear()).slice(-2);
                        const month = String(insertDate.getMonth() + 1).padStart(2, '0');
                        const day = String(insertDate.getDate()).padStart(2, '0');
                        const hours = String(insertDate.getHours()).padStart(2, '0');
                        const minutes = String(insertDate.getMinutes()).padStart(2, '0');
                        const formattedDate = `${year}.${month}.${day} ${hours}:${minutes}`;
                        %>
                        작성일: <%= formattedDate %> 조회수: <%= content.score || 0 %> <span class="comment-info" data-content-id="<%= content.id %>"></span>
                    </div>
                    <p class="content-preview">
                        <% const plainText = content.content.replace(/<[^>]*>/g, '').substring(0, 150); %>
                        <% if (search) { %>
                            <%- plainText.replace(new RegExp('(' + search + ')', 'gi'), '<strong>$1</strong>') %>...
                        <% } else { %>
                            <%= plainText %>...
                        <% } %>
                    </p>
                </article>
            <% }); %>
        </div>

        <div class="pagination">
            <% if (currentPage > 1) { %>
                <a href="/?page=<%= currentPage - 1 %><%= search ? '&search=' + search : '' %><%= sort !== 'recent' ? '&sort=' + sort : '' %>">이전</a>
            <% } %>
            
            <% for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) { %>
                <a href="/?page=<%= i %><%= search ? '&search=' + search : '' %><%= sort !== 'recent' ? '&sort=' + sort : '' %>" 
                   class="<%= i === currentPage ? 'active' : '' %>"><%= i %></a>
            <% } %>
            
            <% if (currentPage < totalPages) { %>
                <a href="/?page=<%= currentPage + 1 %><%= search ? '&search=' + search : '' %><%= sort !== 'recent' ? '&sort=' + sort : '' %>">다음</a>
            <% } %>
        </div>
    </main>

    <footer>
        <p>AI로 작성된 글입니다. 삭제 문의: <a href="mailto:today.h.issue@gmail.com">today.h.issue@gmail.com</a></p>
    </footer>

    <script>
    // 댓글 수 로드
    async function loadCommentCounts() {
        const contentElements = document.querySelectorAll('[data-content-id]');
        const contentIds = [...new Set(Array.from(contentElements).map(el => el.dataset.contentId))];
        
        if (contentIds.length === 0) return;
        
        try {
            const response = await fetch('/api/comments/counts', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ contentIds })
            });
            
            const data = await response.json();
            
            if (data.success) {
                contentIds.forEach(id => {
                    const count = data.counts[id] || 0;
                    
                    // 제목 옆 댓글 수
                    const titleElements = document.querySelectorAll(`.comment-count[data-content-id="${id}"]`);
                    titleElements.forEach(el => {
                        el.textContent = `(${count})`;
                    });
                    
                    // 정보란 댓글 수
                    const infoElements = document.querySelectorAll(`.comment-info[data-content-id="${id}"]`);
                    infoElements.forEach(el => {
                        el.textContent = `댓글: ${count}`;
                    });
                });
            }
        } catch (error) {
            console.error('댓글 수 로드 실패:', error);
        }
    }
    
    // 페이지 로드 시 댓글 수 불러오기
    document.addEventListener('DOMContentLoaded', loadCommentCounts);
    </script>
</body>
</html>